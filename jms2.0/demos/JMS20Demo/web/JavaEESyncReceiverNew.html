<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>
    <body>
        <h1>Using the JMS 2.0 simplified API<br> to receive a message (JavaEESyncReceiverNew)</h1>
        <p>Here is a simple Java EE session bean which demonstrates how to use the JMS 2.0 simplified API to synchronously receive a message.

        <pre>
@Stateless
@LocalBean
public class JavaEESyncReceiverNew {

    @Resource(lookup = "java:global/jms/demoConnectionFactory")
    ConnectionFactory connectionFactory;
    
    @Resource(lookup = "java:global/jms/demoQueue")
    Queue demoQueue;
    
    public String receiveMessageNew() {
        JMSContext context = connectionFactory.createContext();
        try {
            JMSConsumer consumer = context.createConsumer(demoQueue);
            return "Received " + consumer.receivePayload(String.class,1000);
        } finally {
            context.close();
        }
    }
}
        </pre>
        <p>This example shows:
        <ul>
        <li>Use of a <tt>JMSContext</tt> for receiving a message instead of separate <tt>Connection</tt> and <tt>Session</tt> objects
        <li><tt>JMSContext</tt> is created explicitly and then closed after use</li>
        <li>No need to specify <tt>transacted</tt> and <tt>acknowledgeMode</tt> parameters (unlike with <tt>createSession</tt>) in Java EE </li>
        <li>No need to cast the received message to a <tt>TextMessage</tt>  and extract its payload:  message payload is returned directly by the <tt>receive</tt> method</li>
        <li>Need a <tt>try...finally</tt> block to ensure <tt>close</tt> is called, 
        plus at least one more <tt>try</tt> block to handle exceptions.<br>
        (This will get simpler in JMS 2.0 as the Java 7 try-with-resources syntax can be used to avoid an explicit <tt>close()</tt>,
        but this cannot be demonstrated yet as GlassFish 4.0 still requires Java 6)
        <li>This example is for Java EE but the API for Java SE is similar</li>
        </ul>
        <p><a href="JavaEESyncReceiverNewCDI.html">Now compare this with using the JMS 2.0 simplified API and injection to do the same thing</a>
        <p><a href="Servlet1?option=JavaEESyncReceiverNew">Run this example</a>
        <p><a href="/JMS20Demo/">JMS 2.0 examples home</a>
    </body>
</html>